## API: доступные данные
### /couriers
```json
{
  "_id":"dbp7308qh5yxvpyn4cldrva",
   "name":"Екатерина Волкова"
}
```
### /deliviries
```json
{
  "order_id":"63dc615233d239a3bfb6a5a4",
  "order_ts":"2023-02-03 01:20:18.968000",
  "delivery_id":"7dlvayj29xbhlfuf7tv5v7f",
  "courier_id":"qtnp6q8udga28ktd5hb06rp",
  "address":"Ул. Металлургов, 4, кв. 173",
  "delivery_ts":"2023-02-03 02:38:22.587000",
  "rate":5,
  "sum":1151,
  "tip_sum":57
}
```
### /restaurants
```json
{
    "_id":"626a81cfefa404208fe9abae",
    "name":"Кофейня №1"
}
```
## Список полей, которые необходимы для витрины (cdm.dm_courier_ledger)
* id — идентификатор записи.
* courier_id — ID курьера, которому перечисляем.
* courier_name — Ф. И. О. курьера.
* settlement_year — год отчёта.
* settlement_month — месяц отчёта, где 1 — январь и 12 — декабрь.
* orders_count — количество заказов за период (месяц).
* orders_total_sum — общая стоимость заказов.
* rate_avg — средний рейтинг курьера по оценкам пользователей.
* order_processing_fee — сумма, удержанная компанией за обработку заказов, которая высчитывается как orders_total_sum * 0.25.
* courier_order_sum — сумма, которую необходимо перечислить курьеру за доставленные им/ей заказы. За каждый доставленный заказ курьер должен получить некоторую сумму в зависимости от рейтинга (см. ниже).
* courier_tips_sum — сумма, которую пользователи оставили курьеру в качестве чаевых.
* courier_reward_sum — сумма, которую необходимо перечислить курьеру. Вычисляется как courier_order_sum + courier_tips_sum * 0.95 (5% — комиссия за обработку платежа).

Как видно из данных, возвращаемых API, для расчета витрины **нет никакой
необходимости в привлечении сторонних источников - вся необходимая информация у нас уже есть**

## Таблицы слоя DDS
### dm_orders 
* id - идентификатор заказа в рамках DWH
* order_id - индектификатор заказа в источнике
* order_ts - временная метка заказа
* sum - сумма, оплаченная за заказ
### dm_couriers
* id - идентификатор курьера в рамках DWH
* courier_id - идентификатор курьера в источнике
* name - имя курьера
### dm_addresses 
* id - идентификатор адреса доставки в рамках DWH
* address - адрес доставки
### dm_deliveries
* id - идентификатор доставки в рамках DWH
* delivery_id - оригинальный идентификатор доставки
* delivery_ts - временная метка доставки
* rate - оценка доставки
* tip_sum - чаевые доставки 
### fct_deliveries
Таблица фактов - основная для любой последующей аналитики в CDM.
С целью "развязать" профили нагрузки (обновление vs аналитика) мы
дублируем часть данных в fct + организация данных подобным образом позволяет
в принципе уйти от "аналитической" составляющей при формировании таблицы
фактов
* id - идентификатор факта доставки в рамках DWH
* order_id - идентификатор курьера в рамках DWH
* courier_id - идентификатор курьера в рамках DWH
* address_id - идентификатор адреса в рамках DWH
* order_ts - временная метка заказа
* delivery_ts - врменная метка доставки
* sum - сумма, оплаченная за заказ
* rate - оценка доставки
* tip_sum - сумма чаевых
### ## Таблицы слоя STG
Все таблицы слоя STG однотипны: т.к. API не возвращает техническое поле вида update_ts
мы считаем, что **редактирование** объектов не подразумевается системой-источником, 
поэтому **потенциальные обновления в источнике возможны лишь путем создания новых объектов**.
Мы также предполагаем, что все идентификаторы в рамках системы-источника имеют инкрементальный
характер по id и вставка объектов "задним числом" невозможна.

Данные по ресторанам из источника не представляют интереса в рамках
решаемой задачи и не перекладываются в слой stg
### stg.couriers/deliveries
* id - идентификатор объекта в рамках DWH
* object_key - идентификатор из json-данных
* object_value - json-значение объекта из системы-источника


## Дополнительно
* В STG и DDM используется srv-таблица для сохранения курсора загрузки

* Итоговая витрина в CDM формируется инкрементально, с учетом уже имеющихся данных помесячно

